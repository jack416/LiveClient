/*
 * author: Samson.Fan
 *   date: 2015-03-19
 *   file: LiveChatClient.cpp
 *   desc: LiveChat客户端实现类
 */

#include "LiveChatClient.h"
#include "LSLiveChatTaskManager.h"
#include <common/KLog.h>
#include <common/CommonFunc.h>
#include <common/CheckMemoryLeak.h>

// task include
#include "CheckVerTask.h"
#include "LoginTask.h"
#include "SetStatusTask.h"
#include "UploadDeviceIdTask.h"
#include "UploadDeviceTypeTask.h"
#include "EndTalkTask.h"
#include "GetUserStatusTask.h"
#include "GetTalkInfoTask.h"
#include "UploadTicketTask.h"
#include "SendMsgTask.h"
#include "SendEmotionTask.h"
#include "SendVGiftTask.h"
#include "GetVoiceCodeTask.h"
#include "GetLadyVoiceCodeTask.h"
#include "SendVoiceTask.h"
#include "UseTryTicketTask.h"
#include "GetTalkListTask.h"
#include "SendPhotoTask.h"
#include "SendLadyPhotoTask.h"
#include "ShowPhotoTask.h"
#include "GetUserInfoTask.h"
#include "GetUsersInfoTask.h"
#include "GetContactListTask.h"
#include "UploadVerTask.h"
#include "GetBlockUsersTask.h"
#include "GetRecentContactListTask.h"
#include "SearchOnlineManTask.h"
#include "ReplyIdentifyCodeTask.h"
#include "RefreshIdentifyCodeTask.h"
#include "RefreshInviteTemplateTask.h"
#include "GetFeeRecentContactListTask.h"
#include "GetLadyChatInfoTask.h"
#include "SendLadyEditingMsgTask.h"
#include "PlayVideoTask.h"
#include "SendLadyVideoTask.h"
#include "GetLadyConditionTask.h"
#include "GetLadyCustomTemplateTask.h"
#include "UploadPopLadyAutoInviteTask.h"
#include "UploadAutoChargeStatusTask.h"
#include "SendMagicIconTask.h"
#include "GetPaidThemeTask.h"
#include "GetAllPaidThemeTask.h"
#include "UploadThemeListVerTask.h"
#include "ManFeeThemeTask.h"
#include "ManApplyThemeTask.h"
#include "PlayThemeMotionTask.h"
#include "LSLiveChatHearbeatTask.h"
#include "SendAutoInviteTask.h"
#include "GetAutoInviteStatusTask.h"
#include "SendThemeRecommendTask.h"
#include "GetLadyCamStatusTask.h"
#include "SendCamShareInviteTask.h"
#include "ApplyCamShareTask.h"
#include "LadyAcceptCamInviteTask.h"
#include "CamShareHearbeatTask.h"
#include "GetUsersCamStatusTask.h"
#include "GetSessionInfoTask.h"
#include "CamshareUseTryTicketTask.h"
#include "SummitLadyCamStatusTask.h"
#include "GetSessionInfoWithManTask.h"
#include "SummitAutoInviteCamFirstTask.h"

CLiveChatClient::CLiveChatClient()
{
	m_taskManager = NULL;
//	this = NULL;
	m_bInit = false;
	m_isHearbeatThreadRun = false;
	m_hearbeatThread = NULL;
    
    m_listenerListLock = IAutoLock::CreateAutoLock();
    m_listenerListLock->Init();
}

CLiveChatClient::~CLiveChatClient()
{
	FileLog("LiveChatClient", "CLiveChatClient::~CLiveChatClient()");
	delete m_taskManager;
	m_taskManager = NULL;
    IAutoLock::ReleaseAutoLock(m_listenerListLock);
	FileLog("LiveChatClient", "CLiveChatClient::~CLiveChatClient() end");
}

// ------------------------ ILiveChatClient接口函数 -------------------------
// 调用所有接口函数前需要先调用Init
bool CLiveChatClient::Init(const list<string>& svrIPs, unsigned int svrPort)
{
	bool result = false;

	// 初始化 TaskManager
	if (NULL == m_taskManager) {
		m_taskManager = new CLSLiveChatTaskManager();
		if (NULL != m_taskManager) {
			result = m_taskManager->Init(svrIPs, svrPort, this, this);
		}

		// 初始化 seq计数器
		if (result) {
			result = m_seqCounter.Init();
		}

//		if (result) {
//			// 所有初始化都成功，开始赋值
//			this = listener;
//		}

		m_bInit = result;
	}

	return result;
}

// 增加监听器
void CLiveChatClient::AddListener(ILiveChatClientListener* listener) {
    m_listenerListLock->Lock();
    m_listenerList.push_back(listener);
    m_listenerListLock->Unlock();
}

// 移除监听器
void CLiveChatClient::RemoveListener(ILiveChatClientListener* listener) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        if( *itr == listener ) {
            m_listenerList.erase(itr);
            break;
        }
    }
    m_listenerListLock->Unlock();
}

// 判断是否无效seq
bool CLiveChatClient::IsInvalidSeq(int seq)
{
	return m_seqCounter.IsInvalidValue(seq);
}

// 连接服务器
bool CLiveChatClient::ConnectServer()
{
	bool result = false;

	FileLog("LiveChatClient", "CLiveChatClient::ConnectServer() begin");

	if (m_bInit) {
		if (NULL != m_taskManager) {
			if (m_taskManager->IsStart()) {
				m_taskManager->Stop();
			}
			result = m_taskManager->Start();
			FileLog("LiveChatClient", "CLiveChatClient::ConnectServer() result: %d", result);
		}
	}

	FileLog("LiveChatClient", "CLiveChatClient::ConnectServer() end");

	return result;
}

// 登录
bool CLiveChatClient::Login(const string& user, const string& password, const string& deviceId, CLIENT_TYPE clientType, USER_SEX_TYPE sexType, AUTH_TYPE authType)
{
	bool result = false;

	FileLog("LiveChatClient", "CLiveChatClient::Login() begin");

	if (!user.empty()
		&& !password.empty()
		&& !deviceId.empty()
		&& ConnectServer())
	{
		m_user = user;
		m_password = password;
		m_deviceId = deviceId;
		m_clientType = clientType;
		m_sexType = sexType;
		m_authType = authType;

		result = true;
	}

	FileLog("LiveChatClient", "CLiveChatClient::Login() end");

	return result;
}

// 注销
bool CLiveChatClient::Logout()
{
	bool result = false;

	FileLog("LiveChatClient", "CLiveChatClient::Logout() begin, m_taskManager:%p", m_taskManager);

	if (NULL != m_taskManager) {
		FileLog("LiveChatClient", "CLiveChatClient::Logout() m_taskManager->Stop(), m_taskManager:%p", m_taskManager);
		result = m_taskManager->Stop();

		if (result) {
			m_user = "";
			m_password = "";
		}
	}

	FileLog("LiveChatClient", "CLiveChatClient::Logout() end");

	return result;
}

// 设置在线状态
bool CLiveChatClient::SetStatus(USER_STATUS_TYPE status)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SetStatus() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		SetStatusTask* task = new SetStatusTask();
		FileLog("LiveChatClient", "CLiveChatClient::SetStatus() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(status);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::SetStatus() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::SetStatus() end");
	return result;
}

// 结束聊天
bool CLiveChatClient::EndTalk(const string& userId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::EndTalk() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		EndTalkTask* task = new EndTalkTask();
		FileLog("LiveChatClient", "CLiveChatClient::EndTalk() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::EndTalk() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::EndTalk() end");
	return result;
}

// 获取用户在线状态
bool CLiveChatClient::GetUserStatus(const UserIdList& list)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetUserStatus() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetUserStatusTask* task = new GetUserStatusTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetUserStatus() task:%p", task);
		if (NULL != task) {
			// 转换成对方的性别
			USER_SEX_TYPE sexType = (m_sexType == USER_SEX_FEMALE ? USER_SEX_MALE : USER_SEX_FEMALE);

			result = task->Init(this);
			result = result && task->InitParam(sexType, list);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetUserStatus() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetUserStatus() end");
	return result;
}

// 获取会话信息
bool CLiveChatClient::GetTalkInfo(const string& userId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetTalkInfo() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetTalkInfoTask* task = new GetTalkInfoTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetTalkInfo() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetTalkInfo() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetTalkInfo() end");
	return result;
}

// 获取会话信息(仅男士端使用CMD 55)
bool CLiveChatClient::GetSessionInfo(const string& userId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetSessionInfo() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetSessionInfoTask* task = new GetSessionInfoTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetSessionInfo() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetSessionInfo() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetSessionInfo() end");
	return result;
}




// 上传票根
bool CLiveChatClient::UploadTicket(const string& userId, int ticket)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::UploadTicket() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		UploadTicketTask* task = new UploadTicketTask();
		FileLog("LiveChatClient", "CLiveChatClient::UploadTicket() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, ticket);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::UploadTicket() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::UploadTicket() end");
	return result;
}

// 通知对方女士正在编辑消息
bool CLiveChatClient::SendLadyEditingMsg(const string& userId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SendLadyEditingMsg() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		SendLadyEditingMsgTask* task = new SendLadyEditingMsgTask();
		FileLog("LiveChatClient", "CLiveChatClient::SendLadyEditingMsg() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::SendLadyEditingMsg() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::SendLadyEditingMsg() end");
	return result;
}

// 发送聊天消息
bool CLiveChatClient::SendTextMessage(const string& userId, const string& message, bool illegal, int ticket, INVITE_TYPE inviteType)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SendMessage() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		SendMsgTask* task = new SendMsgTask();
		FileLog("LiveChatClient", "CLiveChatClient::SendMessage() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, message, illegal, ticket, inviteType);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::SendMessage() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::SendMessage() end");
	return result;
}

// 发送高级表情
bool CLiveChatClient::SendEmotion(const string& userId, const string& emotionId, int ticket)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SendEmotion() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		SendEmotionTask* task = new SendEmotionTask();
		FileLog("LiveChatClient", "CLiveChatClient::SendEmotion() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, emotionId, ticket);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::SendEmotion() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::SendEmotion() end");
	return result;
}

// 发送虚拟礼物
bool CLiveChatClient::SendVGift(const string& userId, const string& giftId, int ticket)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SendVGift() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		SendVGiftTask* task = new SendVGiftTask();
		FileLog("LiveChatClient", "CLiveChatClient::SendVGift() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, giftId, ticket);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::SendVGift() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::SendVGift() end");
	return result;
}

// 获取语音发送验证码
bool CLiveChatClient::GetVoiceCode(const string& userId, int ticket)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetVoiceCode() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetVoiceCodeTask* task = new GetVoiceCodeTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetVoiceCode() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, ticket);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetVoiceCode() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetVoiceCode() end");
	return result;
}

// 获取女士语音发送验证码
bool CLiveChatClient::GetLadyVoiceCode(const string& userId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetLadyVoiceCode() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetLadyVoiceCodeTask* task = new GetLadyVoiceCodeTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetLadyVoiceCode() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetLadyVoiceCode() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetLadyVoiceCode() end");
	return result;
}

// 发送语音
bool CLiveChatClient::SendVoice(const string& userId, const string& voiceId, int length, int ticket)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SendVoice() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		SendVoiceTask* task = new SendVoiceTask();
		FileLog("LiveChatClient", "CLiveChatClient::SendVoice() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, voiceId, length, ticket);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::SendVoice() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::SendVoice() end");
	return result;
}

// 使用试聊券
bool CLiveChatClient::UseTryTicket(const string& userId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::UseTryTicket() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		UseTryTicketTask* task = new UseTryTicketTask();
		FileLog("LiveChatClient", "CLiveChatClient::UseTryTicket() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::UseTryTicket() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::UseTryTicket() end");
	return result;
}

// 获取邀请列表或在聊列表
bool CLiveChatClient::GetTalkList(int listType)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetTalkList() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetTalkListTask* task = new GetTalkListTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetTalkList() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(listType);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetTalkList() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetTalkList() end");
	return result;
}

// 发送图片
bool CLiveChatClient::SendPhoto(const string& userId, const string& inviteId, const string& photoId, const string& sendId, bool charget, const string& photoDesc, int ticket)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SendPhoto() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		SendPhotoTask* task = new SendPhotoTask();
		FileLog("LiveChatClient", "CLiveChatClient::SendPhoto() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, inviteId, photoId, sendId, charget, photoDesc, ticket);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::SendPhoto() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::SendPhoto() end");
	return result;
}

// 女士发送图片
bool CLiveChatClient::SendLadyPhoto(const string& userId, const string& inviteId, const string& photoId, const string& sendId, bool charget, const string& photoDesc, int ticket)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SendLadyPhoto() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		SendLadyPhotoTask* task = new SendLadyPhotoTask();
		FileLog("LiveChatClient", "CLiveChatClient::SendLadyPhoto() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, inviteId, photoId, sendId, charget, photoDesc, ticket);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::SendLadyPhoto() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::SendLadyPhoto() end");
	return result;
}

// 显示图片
bool CLiveChatClient::ShowPhoto(const string& userId, const string& inviteId, const string& photoId, const string& sendId, bool charget, const string& photoDesc, int ticket)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::ShowPhoto() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		ShowPhotoTask* task = new ShowPhotoTask();
		FileLog("LiveChatClient", "CLiveChatClient::ShowPhoto() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, inviteId, photoId, sendId, charget, photoDesc, ticket);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::ShowPhoto() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::ShowPhoto() end");
	return result;
}

// 获取用户信息
int CLiveChatClient::GetUserInfo(const string& userId)
{
	bool result = false;
    int seq = -1;
	FileLog("LiveChatClient", "CLiveChatClient::GetUserInfo() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetUserInfoTask* task = new GetUserInfoTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetUserInfo() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId);

			if (result) {
				seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetUserInfo() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetUserInfo() end");
	return seq;
}

// 获取多个用户信息
int CLiveChatClient::GetUsersInfo(const list<string>& userIdList)
{
	int seq = m_seqCounter.GetInvalidValue();

	FileLog("LiveChatClient", "CLiveChatClient::GetUsersInfo() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetUsersInfoTask* task = new GetUsersInfoTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetUsersInfo() task:%p", task);
		if (NULL != task) {
			bool result = task->Init(this);
			result = result && task->InitParam(userIdList);

			if (result) {
				seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetUsersInfo() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetUsersInfo() end");

	return seq;
}

// 获取联系人/黑名单列表
bool CLiveChatClient::GetContactList(CONTACT_LIST_TYPE listType)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetContactList() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetContactListTask* task = new GetContactListTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetContactList() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(listType);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetContactList() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetContactList() end");
	return result;
}

// 上传客户端版本号
bool CLiveChatClient::UploadVer(const string& ver)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::UploadVer() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		UploadVerTask* task = new UploadVerTask();
		FileLog("LiveChatClient", "CLiveChatClient::UploadVer() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(ver);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::UploadVer() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::UploadVer() end");
	return result;
}

// 获取被屏蔽女士列表
bool CLiveChatClient::GetBlockUsers()
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetBlockUsers() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetBlockUsersTask* task = new GetBlockUsersTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetBlockUsers() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetBlockUsers() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetBlockUsers() end");
	return result;
}

// 获取最近人列表
bool CLiveChatClient::GetRecentContactList()
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetRecentContactList() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetRecentContactListTask* task = new GetRecentContactListTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetRecentContactList() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetRecentContactList() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetRecentContactList() end");
	return result;
}

// 搜索在线男士
bool CLiveChatClient::SearchOnlineMan(int beginAge, int endAge)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SearchOnlineMan() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		SearchOnlineManTask* task = new SearchOnlineManTask();
		FileLog("LiveChatClient", "CLiveChatClient::SearchOnlineMan() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(beginAge, endAge);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::SearchOnlineMan() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::SearchOnlineMan() end");
	return result;
}

// 回复验证码
bool CLiveChatClient::ReplyIdentifyCode(string identifyCode)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::ReplyIdentifyCode() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		ReplyIdentifyCodeTask* task = new ReplyIdentifyCodeTask();
		FileLog("LiveChatClient", "CLiveChatClient::ReplyIdentifyCode() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(identifyCode);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::ReplyIdentifyCode() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::ReplyIdentifyCode() end");
	return result;
}

// 刷新验证码
bool CLiveChatClient::RefreshIdentifyCode()
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::RefreshIdentifyCode() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		RefreshIdentifyCodeTask* task = new RefreshIdentifyCodeTask();
		FileLog("LiveChatClient", "CLiveChatClient::RefreshIdentifyCode() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::RefreshIdentifyCode() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::RefreshIdentifyCode() end");
	return result;
}

// 刷新邀请模板
bool CLiveChatClient::RefreshInviteTemplate()
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::RefreshInviteTemplate() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		RefreshInviteTemplateTask* task = new RefreshInviteTemplateTask();
		FileLog("LiveChatClient", "CLiveChatClient::RefreshInviteTemplate() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::RefreshInviteTemplate() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::RefreshInviteTemplate() end");
	return result;
}

// 获取已扣费最近联系人列表
bool CLiveChatClient::GetFeeRecentContactList()
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetFeeRecentContactList() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetFeeRecentContactListTask* task = new GetFeeRecentContactListTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetFeeRecentContactList() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetFeeRecentContactList() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetFeeRecentContactList() end");
	return result;
}

// 获取女士聊天信息（包括在聊及邀请的男士列表等）
bool CLiveChatClient::GetLadyChatInfo()
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetLadyChatInfo() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetLadyChatInfoTask* task = new GetLadyChatInfoTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetLadyChatInfo() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetLadyChatInfo() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetLadyChatInfo() end");
	return result;
}

// 播放视频
bool CLiveChatClient::PlayVideo(const string& userId, const string& inviteId, const string& videoId, const string& sendId, bool charget, const string& videoDesc, int ticket)
{
    bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::PlayVideo() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		PlayVideoTask* task = new PlayVideoTask();
		FileLog("LiveChatClient", "CLiveChatClient::PlayVideo() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, inviteId, videoId, sendId, charget, videoDesc, ticket);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::PlayVideo() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::PlayVideo() end");
	return result;
}

// 女士发送微视频
bool CLiveChatClient::SendLadyVideo(const string& userId, const string& inviteId, const string& videoId, const string& sendId, bool charge, const string& videoDesc, int ticket)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SendLadyVideo() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		SendLadyVideoTask* task = new SendLadyVideoTask();
		FileLog("LiveChatClient", "CLiveChatClient::SendLadyVideo() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, inviteId, videoId, sendId, charge, videoDesc, ticket);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::SendLadyVideo() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::SendLadyVideo() end");
	return result;
}

// 获取女士择偶条件
bool CLiveChatClient::GetLadyCondition(const string& userId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetLadyCondition() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetLadyConditionTask* task = new GetLadyConditionTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetLadyCondition() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetLadyCondition() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetLadyCondition() end");
	return result;
}

// 获取女士自定义邀请模板
bool CLiveChatClient::GetLadyCustomTemplate(const string& userId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetLadyCustomTemplate() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetLadyCustomTemplateTask* task = new GetLadyCustomTemplateTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetLadyCustomTemplate() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetLadyCustomTemplate() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetLadyCustomTemplate() end");
	return result;
}

// 弹出女士自动邀请消息通知
bool CLiveChatClient::UploadPopLadyAutoInvite(const string& userId, const string& msg, const string& key)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::UploadPopLadyAutoInvite() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		UploadPopLadyAutoInviteTask* task = new UploadPopLadyAutoInviteTask();
		FileLog("LiveChatClient", "CLiveChatClient::UploadPopLadyAutoInvite() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, msg, key);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::UploadPopLadyAutoInvite() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::UploadPopLadyAutoInvite() end");
	return result;
}

// 上传自动充值状态
bool CLiveChatClient::UploadAutoChargeStatus(bool isCharge)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::UploadAutoChargeStatus() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		UploadAutoChargeStatusTask* task = new UploadAutoChargeStatusTask();
		FileLog("LiveChatClient", "CLiveChatClient::UploadAutoChargeStatus() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(isCharge);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::UploadAutoChargeStatus() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::UploadAutoChargeStatus() end");
	return result;
}

// 发送小高级表情
bool CLiveChatClient::SendMagicIcon(const string& userId, const string& iconId, int ticket)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SendMagicIcon() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		SendMagicIconTask* task = new SendMagicIconTask();
		FileLog("LiveChatClient", "CLiveChatClient::SendMagicIcon() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, iconId, ticket);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::SendMagicIcon() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::SendMagicIcon() end");
	return result;
}

// 获取指定男/女士的已购主题包
bool CLiveChatClient::GetPaidTheme(const string& userId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetPaidTheme() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetPaidThemeTask* task = new GetPaidThemeTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetPaidTheme() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetPaidTheme() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetPaidTheme() end");
	return result;
}

// 获取男/女士所有已购主题包
bool CLiveChatClient::GetAllPaidTheme()
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetAllPaidTheme() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		GetAllPaidThemeTask* task = new GetAllPaidThemeTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetAllPaidTheme() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetAllPaidTheme() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetAllPaidTheme() end");
	return result;
}

// 上传主题包列表版本号
bool CLiveChatClient::UploadThemeListVer(int themeVer)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::UploadThemeListVer() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		UploadThemeListVerTask* task = new UploadThemeListVerTask();
		FileLog("LiveChatClient", "CLiveChatClient::UploadThemeListVer() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(themeVer);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::UploadThemeListVer() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::UploadThemeListVer() end");
	return result;
}

// 男士购买主题包
bool CLiveChatClient::ManFeeTheme(const string& userId, const string& themeId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::ManFeeTheme() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		ManFeeThemeTask* task = new ManFeeThemeTask();
		FileLog("LiveChatClient", "CLiveChatClient::ManFeeTheme() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, themeId);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::ManFeeTheme() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::ManFeeTheme() end");
	return result;
}

// 男士应用主题包
bool CLiveChatClient::ManApplyTheme(const string& userId, const string& themeId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::ManApplyTheme() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		ManApplyThemeTask* task = new ManApplyThemeTask();
		FileLog("LiveChatClient", "CLiveChatClient::ManApplyTheme() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, themeId);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::ManApplyTheme() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::ManApplyTheme() end");
	return result;
}

// 男/女士播放主题包动画
bool CLiveChatClient::PlayThemeMotion(const string& userId, const string& themeId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::PlayThemeMotion() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		PlayThemeMotionTask* task = new PlayThemeMotionTask();
		FileLog("LiveChatClient", "CLiveChatClient::PlayThemeMotion() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, themeId);

			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::PlayThemeMotion() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::PlayThemeMotion() end");
	return result;
}

// 获取自动邀请状态（仅女士）
bool CLiveChatClient:: GetAutoInviteMsgSwitchStatus()
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetAutoInviteStatus() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		 GetAutoInviteStatusTask* task = new GetAutoInviteStatusTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetAutoInviteStatus() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetAutoInviteStatus() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetAutoInviteStatus() end");
	return result;
}

// 启动/关闭发送自动邀请消息（仅女士）
bool CLiveChatClient::SwitchAutoInviteMsg(bool isOpen)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SendAutoInvite() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		 SendAutoInviteTask* task = new SendAutoInviteTask();
		FileLog("LiveChatClient", "CLiveChatClient::SendAutoInvite() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(isOpen);
			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::SendAutoInvite() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::SendAutoInvite() end");
	return result;
}

// 女士推荐男士购买主题包（仅女士）
bool CLiveChatClient::RecommendThemeToMan(const string& userId, const string& themeId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SendThemeRecommend() begin");
	if (NULL != m_taskManager
		&& m_taskManager->IsStart())
	{
		 SendThemeRecommendTask* task = new SendThemeRecommendTask();
		FileLog("LiveChatClient", "CLiveChatClient::SendThemeRecommend() task:%p", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId, themeId);
			if (result) {
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::SendThemeRecommend() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::SendThemeRecommend() end");
	return result;
}

// 获取女士Cam状态
int CLiveChatClient::GetLadyCamStatus(const string& userId)
{
	bool result = false;
    int seq = -1;
	FileLog("LiveChatClient", "CLiveChatClient::GetLadyCamstatus() begin");
	if (NULL != m_taskManager && m_taskManager->IsStart()){
		GetLadyCamStatusTask* task = new GetLadyCamStatusTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetLadyCamStatus() task:%p begin", task);
		if (NULL != task) {
			result = task->Init(this);
			result = result && task->InitParam(userId);

			if(result) {
				seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetLadyCamStatus() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetLadyCamStatus() end");
	return seq;
}

// 发送CamShare邀请
bool CLiveChatClient::SendCamShareInvite(const string& userId, CamshareInviteType inviteType, int sessionId, const string& fromName)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SendCamShareInvite() begin");
	if(NULL != m_taskManager && m_taskManager->IsStart()){
		SendCamShareInviteTask* task = new SendCamShareInviteTask();
		FileLog("LiveChatClient", "CLiveChatClient::SendCamShareInvite() task:%p begin", task);
		if(NULL != task){
			result = task->Init(this);
			result = result && task->InitParam(userId, inviteType, sessionId, fromName);

			if(result){
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}

		FileLog("LiveChatClient", "CLiveChatClient::SendCamShareInvite() task:%p end", task);
	}

	FileLog("LiveChatClient", "CLiveChatClient::SendCamShareInvite() end");
	return result;
}

// 男士发起CamShare并开始扣费
bool CLiveChatClient::ApplyCamShare(const string& userId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::ApplyCamShare() begin");
    if(NULL != m_taskManager && m_taskManager->IsStart())
	{
		ApplyCamShareTask* task = new ApplyCamShareTask();
		FileLog("LiveChatClient", "CLiveChatClient::ApplyCamShare() task:%p begin", task);
		if(NULL != task){
			result = task->Init(this);
			result = result && task->InitParam(userId);
			if(result){
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::ApplyCamShare() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::ApplyCamShare() end");
	return result;
}

// 女士接受男士Cam邀请
bool CLiveChatClient::LadyAcceptCamInvite(const string& userId, CamshareLadyInviteType inviteType, int sessionId, const string& fromName, bool isOpenCam)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::LadyAcceptCamInvite() begin");
    if(NULL != m_taskManager && m_taskManager->IsStart())
	{
		LadyAcceptCamInviteTask* task = new LadyAcceptCamInviteTask();
		FileLog("LiveChatClient", "CLiveChatClient::LadyAcceptCamInvite() task:%p begin", task);
		if(NULL != task){
			result = task->Init(this);
            result = result && task->InitParam(userId, inviteType, sessionId, fromName, isOpenCam);
			if(result){
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::LadyAcceptCamInvite() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::LadyAcceptCamInvite() end");
	return result;
}

// CamShare聊天扣费心跳
bool CLiveChatClient::CamShareHearbeat(const string& userId, const string& inviteId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::CamShareHearbeat() begin");
	if(NULL != m_taskManager && m_taskManager->IsStart())
	{
		CamShareHearbeatTask* task = new CamShareHearbeatTask();
		FileLog("LiveChatClient", "CLiveChatClient::CamShareHearbeat() task:%p begin", task);
		if(NULL != task){
			result = task->Init(this);
			result = result && task->InitParam(userId, inviteId);
			if(result){
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::CamShareHearbeat() task:%p end", task);

	}
	FileLog("LiveChatClient", "CLiveChatClient::CamShareHearbeat() end");
	return result;
}

// 批量获取女士端Cam状态
bool CLiveChatClient::GetUsersCamStatus(const UserIdList& list)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetUsersCamStatus() begin");
	if(NULL != m_taskManager && m_taskManager->IsStart())
	{
		GetUsersCamStatusTask* task = new GetUsersCamStatusTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetUsersCamStatus() task:%p begin", task);
		if(NULL != task){
			result = task->Init(this);
			result = result && task->InitParam(list);
			if(result){
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetUsersCamStatus() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetUsersCamStatus() end");
	return result;
}

// Camshare使用试聊券
bool CLiveChatClient::CamshareUseTryTicket(const string& targetId, const string& ticketId)
{
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::CamshareUseTryTicketTask() begin");
	if(NULL != m_taskManager && m_taskManager->IsStart())
	{
		CamshareUseTryTicketTask* task = new CamshareUseTryTicketTask();
		FileLog("LiveChatClient", "CLiveChatClient::CamshareUseTryTicketTask() task:%p begin", task);
		if(NULL != task){
			result = task->Init(this);
			result = result && task->InitParam(targetId, ticketId);
			if(result){
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::CamshareUseTryTicketTask() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::CamshareUseTryTicketTask() end");
	return result;
}
// 女士端更新Camshare服务状态到服务器
bool CLiveChatClient::SummitLadyCamStatus(CAMSHARE_STATUS_TYPE camStatus){
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SummitLadyCamStatusTask() begin");
	if(NULL != m_taskManager && m_taskManager->IsStart())
	{
		SummitLadyCamStatusTask* task = new SummitLadyCamStatusTask();
		FileLog("LiveChatClient", "CLiveChatClient::SummitLadyCamStatusTask() task:%p begin", task);
		if(NULL != task){
			result = task->Init(this);
			result = result && task->InitParam(camStatus);
			if(result){
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::SummitLadyCamStatusTask() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::SummitLadyCamStatusTask() end");
	return result;
}
// 女士端获取会话信息
bool CLiveChatClient::GetSessionInfoWithMan(const string& targetId){
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::GetSessionInfoWithManTask() begin");
	if(NULL != m_taskManager && m_taskManager->IsStart())
	{
		GetSessionInfoWithManTask* task = new GetSessionInfoWithManTask();
		FileLog("LiveChatClient", "CLiveChatClient::GetSessionInfoWithManTask() task:%p begin", task);
		if(NULL != task){
			result = task->Init(this);
			result = result && task->InitParam(targetId);
			if(result){
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::GetSessionInfoWithManTask() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::GetSessionInfoWithManTask() end");
	return result;
}

// 女士端设置小助手Cam优先
bool CLiveChatClient::SummitAutoInviteCamFirst(bool camFirst){
	bool result = false;
	FileLog("LiveChatClient", "CLiveChatClient::SummitAutoInviteCamFirst() begin");
	if(NULL != m_taskManager && m_taskManager->IsStart())
	{
		SummitAutoInviteCamFirstTask* task = new SummitAutoInviteCamFirstTask();
		FileLog("LiveChatClient", "CLiveChatClient::SummitAutoInviteCamFirst() task:%p begin", task);
		if(NULL != task){
			result = task->Init(this);
			result = result && task->InitParam(camFirst);
			if(result){
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				result = m_taskManager->HandleRequestTask(task);
			}
		}
		FileLog("LiveChatClient", "CLiveChatClient::SummitAutoInviteCamFirst() task:%p end", task);
	}
	FileLog("LiveChatClient", "CLiveChatClient::SummitAutoInviteCamFirst() end");
	return result;
}

// 获取用户账号
string CLiveChatClient::GetUser()
{
	return m_user;
}

int CLiveChatClient::GetSocket() {
    return m_taskManager->GetSocket();
}
// ------------------------ ITaskManagerListener接口函数 -------------------------
// 连接成功回调
void CLiveChatClient::OnConnect(bool success)
{
	FileLog("LiveChatClient", "CLiveChatClient::OnConnect() success: %d", success);
	if (success) {
		FileLog("LiveChatClient", "CLiveChatClient::OnConnect() CheckVersionProc()");
		// 连接服务器成功，检测版本号
		CheckVersionProc();
		// 启动发送心跳包线程
		HearbeatThreadStart();
	}
	else {
		FileLog("LiveChatClient", "CLiveChatClient::OnConnect() LCC_ERR_CONNECTFAIL, this:%p", this);
		this->OnLogin(LCC_ERR_CONNECTFAIL, "");
	}
	FileLog("LiveChatClient", "CLiveChatClient::OnConnect() end");
}

// 断开连接或连接失败回调（先回调OnDisconnect()再回调OnDisconnect(const TaskList& list)）
void CLiveChatClient::OnDisconnect()
{
	// 停止心跳线程
	if (NULL != m_hearbeatThread) {
		m_isHearbeatThreadRun = false;
		m_hearbeatThread->WaitAndStop();
		ILSLiveChatThreadHandler::ReleaseThreadHandler(m_hearbeatThread);
		m_hearbeatThread = NULL;
	}	
}

// 断开连接或连接失败回调(listUnsentTask：未发送的task列表)
void CLiveChatClient::OnDisconnect(const TaskList& listUnsentTask)
{
	// 各任务回调OnDisconnect
	TaskList::const_iterator iter;
	for (iter = listUnsentTask.begin();
		iter != listUnsentTask.end();
		iter++)
	{
		(*iter)->OnDisconnect();
	}

	// 回调 OnLogout
	this->OnLogout(LCC_ERR_CONNECTFAIL, "");
}

// 已完成交互的task
void CLiveChatClient::OnTaskDone(ILSLiveChatTask* task)
{
	if (NULL != task) {
		// 需要LiveChatClient处理后续相关业务逻辑的task（如：检测版本）
		switch (task->GetCmdCode()) {
		case TCMD_CHECKVER:
			OnCheckVerTaskDone(task);
			break;
		case TCMD_LOGIN:
			UploadDeviceIdProc();
			break;
		case TCMD_UPLOADDEVID:
			UploadDeviceTypeProc();
			break;
		}
	}
}

// 检测版本已经完成
void CLiveChatClient::OnCheckVerTaskDone(ILSLiveChatTask* task)
{
	LCC_ERR_TYPE errType = LCC_ERR_FAIL;
	string errMsg("");
	task->GetHandleResult(errType, errMsg);
	if (LCC_ERR_SUCCESS == errType) {
		// 检测版本成功，进行登录操作
		LoginProc();
	}
	else {
		// 检测版本失败，回调给上层
		this->OnLogin(errType, errMsg);
	}
}

// ------------------------ 操作处理函数 ------------------------------
// 检测版本号
bool CLiveChatClient::CheckVersionProc()
{
	bool result = false;
	CheckVerTask* checkVerTask = new CheckVerTask();
	if (NULL != checkVerTask) {
		checkVerTask->Init(this);
		checkVerTask->InitParam("1.1.0.0XCHAT");

		int seq = m_seqCounter.GetAndIncrement();
		checkVerTask->SetSeq(seq);
		result = m_taskManager->HandleRequestTask(checkVerTask);
	}
	return result;
}

// 登录
bool CLiveChatClient::LoginProc()
{
	bool result = false;
	LoginTask* loginTask = new LoginTask();
	if (NULL != loginTask) {
		loginTask->Init(this);
		loginTask->InitParam(m_user, m_password, m_clientType, m_sexType, m_authType);

		int seq = m_seqCounter.GetAndIncrement();
		loginTask->SetSeq(seq);
		result =  m_taskManager->HandleRequestTask(loginTask);
	}
	return result;
}

// 上传设备ID
bool CLiveChatClient::UploadDeviceIdProc()
{
	bool result = false;
	UploadDeviceIdTask* task = new UploadDeviceIdTask();
	if (NULL != task) {
		task->Init(this);
		task->InitParam(m_deviceId);

		int seq = m_seqCounter.GetAndIncrement();
		task->SetSeq(seq);
		result =  m_taskManager->HandleRequestTask(task);
	}
	return result;
}

// 上传设备类型
bool CLiveChatClient::UploadDeviceTypeProc()
{
	bool result = false;
	UploadDeviceTypeTask* task = new UploadDeviceTypeTask();
	if (NULL != task) {
		task->Init(this);
		task->InitParam(m_clientType);

		int seq = m_seqCounter.GetAndIncrement();
		task->SetSeq(seq);
		result =  m_taskManager->HandleRequestTask(task);
	}
	return result;
}

// ------------------------ 心跳处理函数 ------------------------------
void CLiveChatClient::HearbeatThreadStart()
{
	// 启动心跳处理线程
	m_isHearbeatThreadRun = true;
	if (NULL == m_hearbeatThread) {
		m_hearbeatThread = ILSLiveChatThreadHandler::CreateThreadHandler();
		m_hearbeatThread->Start(HearbeatThread, this);
	}
}

TH_RETURN_PARAM CLiveChatClient::HearbeatThread(void* arg)
{
	CLiveChatClient* pThis = (CLiveChatClient*)arg;
	pThis->HearbeatProc();
	return NULL;
}

void CLiveChatClient::HearbeatProc()
{
	FileLog("LiveChatClient", "CLiveChatClient::HearbeatProc() begin");

	const unsigned long nSleepStep = 200;	// ms
	const unsigned long nSendStep = 30 * 1000; // ms

	long long preTime = getCurrentTime();
	long long curTime = getCurrentTime();
	do {
		curTime = getCurrentTime();
		if (DiffTime(preTime, curTime) >= nSendStep) {
			LSLiveChatHearbeatTask* task = new LSLiveChatHearbeatTask();
			if (NULL != task) {
				task->Init(this);
				int seq = m_seqCounter.GetAndIncrement();
				task->SetSeq(seq);
				m_taskManager->HandleRequestTask(task);
			}
			preTime = curTime;
		}
		Sleep(nSleepStep);
	} while (m_isHearbeatThreadRun);

	FileLog("LiveChatClient", "CLiveChatClient::HearbeatProc() end");
}


/**************************************** LiveChatClient Callback ****************************************/
void CLiveChatClient::OnLogin(LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnLogin(err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnLogout(LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnLogout(err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnSetStatus(LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnSetStatus(err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnEndTalk(const string& inUserId, LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnEndTalk(inUserId, err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetUserStatus(const UserIdList& inList, LCC_ERR_TYPE err, const string& errmsg, const UserStatusList& list) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetUserStatus(inList, err, errmsg, list);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetTalkInfo(const string& inUserId, LCC_ERR_TYPE err, const string& errmsg, const string& userId, const string& invitedId, bool charge, unsigned int chatTime) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetTalkInfo(inUserId, err, errmsg, userId, invitedId, charge, chatTime);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetSessionInfo(const string& inUserId, LCC_ERR_TYPE err, const string& errmsg, const SessionInfoItem& sessionInfo) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetSessionInfo(inUserId, err, errmsg, sessionInfo);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnSendTextMessage(const string& inUserId, const string& inMessage, int inTicket, LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnSendTextMessage(inUserId, inMessage, inTicket, err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnSendEmotion(const string& inUserId, const string& inEmotionId, int inTicket, LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnSendEmotion(inUserId, inEmotionId, inTicket, err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnSendVGift(const string& inUserId, const string& inGiftId, int inTicket, LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnSendVGift(inUserId, inGiftId, inTicket, err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetVoiceCode(const string& inUserId, int inTicket, LCC_ERR_TYPE err, const string& errmsg, const string& voiceCode) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetVoiceCode(inUserId, inTicket, err, errmsg, voiceCode);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnSendVoice(const string& inUserId, const string& inVoiceId, int inTicket, LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnSendVoice(inUserId, inVoiceId, inTicket, err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnUseTryTicket(const string& inUserId, LCC_ERR_TYPE err, const string& errmsg, const string& userId, TRY_TICKET_EVENT tickEvent) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnUseTryTicket(inUserId, err, errmsg, userId, tickEvent);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetTalkList(int inListType, LCC_ERR_TYPE err, const string& errmsg, const TalkListInfo& talkListInfo) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetTalkList(inListType, err, errmsg, talkListInfo);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnSendPhoto(LCC_ERR_TYPE err, const string& errmsg, int ticket) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnSendPhoto(err, errmsg, ticket);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnSendLadyPhoto(LCC_ERR_TYPE err, const string& errmsg, int ticket) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnSendLadyPhoto(err, errmsg, ticket);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnShowPhoto(LCC_ERR_TYPE err, const string& errmsg, int ticket) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnShowPhoto(err, errmsg, ticket);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetUserInfo(int seq, const string& inUserId, LCC_ERR_TYPE err, const string& errmsg, const UserInfoItem& userInfo) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetUserInfo(seq, inUserId, err, errmsg, userInfo);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetUsersInfo(LCC_ERR_TYPE err, const string& errmsg, int seq, const list<string>& userIdList, const UserInfoList& userList) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetUsersInfo(err, errmsg, seq, userIdList, userList);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetContactList(CONTACT_LIST_TYPE inListType, LCC_ERR_TYPE err, const string& errmsg, const TalkUserList& list) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetContactList(inListType, err, errmsg, list);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetBlockUsers(LCC_ERR_TYPE err, const string& errmsg, const list<string>& users) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetBlockUsers(err, errmsg, users);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnSearchOnlineMan(LCC_ERR_TYPE err, const string& errmsg, const list<string>& userList) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnSearchOnlineMan(err, errmsg, userList);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnReplyIdentifyCode(LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnReplyIdentifyCode(err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetRecentContactList(LCC_ERR_TYPE err, const string& errmsg, const list<string>& userList) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetRecentContactList(err, errmsg, userList);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetFeeRecentContactList(LCC_ERR_TYPE err, const string& errmsg, const list<string>& userList) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetFeeRecentContactList(err, errmsg, userList);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetLadyChatInfo(LCC_ERR_TYPE err, const string& errmsg, const list<string>& chattingList, const list<string>& chattingInviteIdList, const list<string>& missingList, const list<string>& missingInviteIdList) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetLadyChatInfo(err, errmsg, chattingList, chattingInviteIdList, missingList, missingInviteIdList);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnPlayVideo(LCC_ERR_TYPE err, const string& errmsg, int ticket) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnPlayVideo(err, errmsg, ticket);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnSendLadyVideo(LCC_ERR_TYPE err, const string& errmsg, int ticket) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnSendLadyVideo(err, errmsg, ticket);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetLadyCondition(const string& inUserId, LCC_ERR_TYPE err, const string& errmsg, const LadyConditionItem& item) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetLadyCondition(inUserId, err, errmsg, item);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetLadyCustomTemplate(const string& inUserId, LCC_ERR_TYPE err, const string& errmsg, const vector<string>& contents, const vector<bool>& flags) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetLadyCustomTemplate(inUserId, err, errmsg, contents, flags);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnSendMagicIcon(const string& inUserId, const string& inIconId, int inTicket, LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnSendMagicIcon(inUserId, inIconId, inTicket, err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetPaidTheme(const string& inUserId, LCC_ERR_TYPE err, const string& errmsg, const ThemeInfoList& themeList) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetPaidTheme(inUserId, err, errmsg, themeList);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetAllPaidTheme(LCC_ERR_TYPE err, const string& errmsg, const ThemeInfoList& themeInfoList) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetAllPaidTheme(err, errmsg, themeInfoList);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnManFeeTheme(const string& inUserId, const string& inThemeId, LCC_ERR_TYPE err, const string& errmsg, const ThemeInfoItem& item) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnManFeeTheme(inUserId, inThemeId, err, errmsg, item);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnManApplyTheme(const string& inUserId, const string& inThemeId, LCC_ERR_TYPE err, const string& errmsg, const ThemeInfoItem& item) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnManApplyTheme(inUserId, inThemeId, err, errmsg, item);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnPlayThemeMotion(const string& inUserId, const string& inThemeId, LCC_ERR_TYPE err, const string& errmsg, bool success) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnPlayThemeMotion(inUserId, inThemeId, err, errmsg, success);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetAutoInviteMsgSwitchStatus(LCC_ERR_TYPE err, const string& errmsg, bool isOpenStatus) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetAutoInviteMsgSwitchStatus(err, errmsg, isOpenStatus);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnSwitchAutoInviteMsg(LCC_ERR_TYPE err, const string& errmsg, bool isOpenStatus) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnSwitchAutoInviteMsg(err, errmsg, isOpenStatus);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecommendThemeToMan(const string& inUserId, const string& inThemeId,LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecommendThemeToMan(inUserId, inThemeId, err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetSessionInfoWithMan(const string& inUserId, LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetSessionInfoWithMan(inUserId, err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetLadyCamStatus(int seq, const string& inUserId, LCC_ERR_TYPE err, const string& errmsg, bool isOpenCam) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetLadyCamStatus(seq, inUserId, err, errmsg, isOpenCam);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnSendCamShareInvite(const string& inUserId, LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnSendCamShareInvite(inUserId, err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnApplyCamShare(const string& inUserId, LCC_ERR_TYPE err, const string& errmsg, bool isSuccess, const string& targetId) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnApplyCamShare(inUserId, err, errmsg, isSuccess, targetId);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnLadyAcceptCamInvite(const string& inUserId, LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnLadyAcceptCamInvite(inUserId, err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnGetUsersCamStatus(const UserIdList& inList, LCC_ERR_TYPE err, const string& errmsg, const UserCamStatusList& list) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnGetUsersCamStatus(inList, err, errmsg, list);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnCamshareUseTryTicket(LCC_ERR_TYPE err, const string& errmsg, const string& userId, const string& ticketId, const string& inviteId) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnCamshareUseTryTicket(err, errmsg, userId, ticketId, inviteId);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnSummitLadyCamStatus(LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnSummitLadyCamStatus(err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnSummitAutoInviteCamFirst(LCC_ERR_TYPE err, const string& errmsg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnSummitAutoInviteCamFirst(err, errmsg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvMessage(const string& toId, const string& fromId, const string& fromName, const string& inviteId, bool charge, int ticket, TALK_MSG_TYPE msgType, const string& message, INVITE_TYPE inviteType) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvMessage(toId, fromId, fromName, inviteId, charge, ticket, msgType, message, inviteType);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvEmotion(const string& toId, const string& fromId, const string& fromName, const string& inviteId, bool charge, int ticket, TALK_MSG_TYPE msgType, const string& emotionId) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvEmotion(toId, fromId, fromName, inviteId, charge, ticket, msgType, emotionId);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvVoice(const string& toId, const string& fromId, const string& fromName, const string& inviteId, bool charge, TALK_MSG_TYPE msgType, const string& voiceId, const string& fileType, int timeLen) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvVoice(toId, fromId, fromName, inviteId, charge, msgType, voiceId, fileType, timeLen);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvWarning(const string& toId, const string& fromId, const string& fromName, const string& inviteId, bool charge, int ticket, TALK_MSG_TYPE msgType, const string& message) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvWarning(toId, fromId, fromName, inviteId, charge, ticket, msgType, message);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnUpdateStatus(const string& userId, const string& server, CLIENT_TYPE clientType, USER_STATUS_TYPE statusType) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnUpdateStatus(userId, server, clientType, statusType);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnUpdateTicket(const string& fromId, int ticket) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnUpdateTicket(fromId, ticket);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvEditMsg(const string& fromId) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvEditMsg(fromId);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvTalkEvent(const string& userId, TALK_EVENT_TYPE eventType) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvTalkEvent(userId, eventType);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvTryTalkBegin(const string& toId, const string& fromId, int time) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvTryTalkBegin(toId, fromId, time);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvTryTalkEnd(const string& userId) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvTryTalkEnd(userId);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvEMFNotice(const string& fromId, TALK_EMF_NOTICE_TYPE noticeType) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvEMFNotice(fromId, noticeType);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvKickOffline(KICK_OFFLINE_TYPE kickType) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvKickOffline(kickType);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvPhoto(const string& toId, const string& fromId, const string& fromName, const string& inviteId, const string& photoId, const string& sendId, bool charge, const string& photoDesc, int ticket) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvPhoto(toId, fromId, fromName, inviteId, photoId, sendId, charge, photoDesc, ticket);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvShowPhoto(const string& toId, const string& fromId, const string& fromName, const string& inviteId, const string& photoId, const string& sendId, bool charge, const string& photoDesc, int ticket) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvShowPhoto(toId, fromId, fromName, inviteId, photoId, sendId, charge, photoDesc, ticket);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvLadyVoiceCode(const string& voiceCode) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvLadyVoiceCode(voiceCode);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvIdentifyCode(const unsigned char* data, long dataLen) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvIdentifyCode(data, dataLen);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvVideo(const string& toId, const string& fromId, const string& fromName, const string& inviteId, const string& videoId, const string& sendId, bool charge, const string& videoDesc, int ticket) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvVideo(toId, fromId, fromName, inviteId, videoId, sendId, charge, videoDesc, ticket);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvShowVideo(const string& toId, const string& fromId, const string& fromName, const string& inviteId, const string& videoId, const string& sendId, bool charge, const string& videoDesc, int ticket) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvShowVideo(toId, fromId, fromName, inviteId, videoId, sendId, charge, videoDesc, ticket);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvAutoInviteMsg(const string& womanId, const string& manId, const string& key) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvAutoInviteMsg(womanId, manId, key);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvAutoChargeResult(const string& manId, double money, TAUTO_CHARGE_TYPE type, bool result, const string& code, const string& msg) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvAutoChargeResult(manId, money, type, result, code, msg);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvMagicIcon(const string& toId, const string& fromId, const string& fromName, const string& inviteId, bool charge, int ticket, TALK_MSG_TYPE msgType, const string& iconId) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvMagicIcon(toId, fromId, fromName, inviteId, charge, ticket, msgType, iconId);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvThemeMotion(const string& themeId, const string& manId, const string& womanId) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvThemeMotion(themeId, manId, womanId);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvThemeRecommend(const string& themeId, const string& manId, const string& womanId) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvThemeRecommend(themeId, manId, womanId);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnAutoInviteStatusUpdate(bool isOpenStatus) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnAutoInviteStatusUpdate(isOpenStatus);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvAutoInviteNotify(const string& womanId,const string& manId,const string& message,const string& inviteId) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvAutoInviteNotify(womanId, manId, message, inviteId);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnManApplyThemeNotify(const ThemeInfoItem& item) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnManApplyThemeNotify(item);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnManBuyThemeNotify(const ThemeInfoItem& item) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnManBuyThemeNotify(item);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvLadyCamStatus(const string& userId, USER_STATUS_PROTOCOL statusId, const string& server, CLIENT_TYPE clientType, CamshareLadySoundType sound, const string& version) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvLadyCamStatus(userId, statusId, server, clientType, sound, version);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvAcceptCamInvite(const string& fromId, const string& toId, CamshareLadyInviteType inviteType, int sessionId, const string& fromName, bool isCamOpen) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvAcceptCamInvite(fromId, toId, inviteType, sessionId, fromName, isCamOpen);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvManCamShareInvite(const string& fromId, const string& toId, CamshareInviteType inviteType, int sessionId, const string& fromName) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvManCamShareInvite(fromId, toId, inviteType, sessionId, fromName);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvManCamShareStart(const string& manId, const string& womanId, const string& inviteId) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvManCamShareStart(manId, womanId, inviteId);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvCamHearbeatException(const string& exceptionName, LCC_ERR_TYPE err, const string& targetId) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvCamHearbeatException(exceptionName, err, targetId);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvManSessionInfo(const SessionInfoItem& sessionInfo) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvManSessionInfo(sessionInfo);
    }
    m_listenerListLock->Unlock();
}

void CLiveChatClient::OnRecvManJoinOrExitConference(MAN_CONFERENCE_EVENT_TYPE eventType, const string& fromId, const string& toId, const list<string>& userList) {
    m_listenerListLock->Lock();
    for(LiveChatClientListenerList::const_iterator itr = m_listenerList.begin(); itr != m_listenerList.end(); itr++) {
        ILiveChatClientListener* callback = *itr;
        callback->OnRecvManJoinOrExitConference(eventType, fromId, toId, userList);
    }
    m_listenerListLock->Unlock();
}


/**************************************** LiveChatClient Callback End ****************************************/
